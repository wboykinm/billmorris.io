<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 6.0.1 | Copyright Dean Attali 2023 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Separation of Concerns</title>

  

  <meta name="description" content="I have a minor quibble.">

  

  

  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/shoals/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/shoals/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Shoals">
  <meta property="og:title" content="Separation of Concerns">
  <meta property="og:description" content="I have a minor quibble.">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="">
  <meta property="og:article:published_time" content="2014-08-24T14:08:18-04:00">
  <meta property="og:url" content="/shoals/2014/08/24/separation-of-concerns.html">
  <link rel="canonical" href="/shoals/2014/08/24/separation-of-concerns.html">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="Separation of Concerns">
  <meta property="twitter:description" content="I have a minor quibble.">

  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="/shoals">Shoals</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto"></ul>
  </div>

  

  

</nav>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Separation of Concerns</h1>
          
            
              <h2 class="post-subheading">I have a minor quibble.</h2>
            
          

          
            <span class="post-meta">Posted on August 24, 2014</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <blockquote>
  <p>Working with shaded relief and satellite imagery in Mapbox Studio</p>
</blockquote>

<h3 id="i-have-a-minor-quibble">I have a minor quibble.</h3>

<p>Amid the wonders that the Mapbox team has been producing of late, they’ve rebranded the groundbreaking Tilemill as <a href="https://www.mapbox.com/mapbox-studio/#darwin">Mapbox Studio</a>, given it a souped-up engine powered by OpenStreetmap-based vector tiles, and turned it loose on the beta crowd to a reception somewhere between “rapturous” and “bieberesque”. It makes web mapping both better-supported and more flexible, and at <a href="http://faraday.io/">Faraday</a> we quickly used it to build <a href="https://api.tiles.mapbox.com/v4/faraday2.74974c94/page.html?access_token=pk.eyJ1IjoiZmFyYWRheTIiLCJhIjoiTUVHbDl5OCJ9.buFaqIdaIM3iXr1BOYKpsQ#14/42.3591/-71.0639">our basemap</a>.</p>

<p>Mapbox Studio comes with four starter templates . . .</p>

<p><img src="/shoals/assets/img/2014-08-24_1.png" alt="image" /></p>

<p>. . . and my quibble is with the <a href="https://github.com/mapbox/satellite-afternoon.tm2">“Satellite Afternoon” template</a>. I played with it for awhile before I noticed I was unhappy with it in a familiar way. Back in my desktop GIS days I had frequently used an ESRI-provided basemap that tried to do the same thing: Overlay shaded relief on satellite imagery. At the time I couldn’t quite place what I found wrong with this kind of basemap, but it’s now clear looking at the Mapbox version:</p>

<h3 id="the-shadows-arent-lining-up">The shadows aren’t lining up.</h3>

<p>Shaded relief maps present a stylized view of sunlight smacking terrain. Satellite imagery — unless acquired at nadir angle — shows actual sunlight on terrain. It’s very unlikely that the two will have exactly the same zenith and azimuth angles by chance:</p>

<p><img src="/shoals/assets/img/2014-08-24_2.png" alt="image" /></p>

<p>Mapbox Satellite view of the peaks near Eldorado Canyon in Colorado. Note the sun azimuth angle from the Southeast, casting shadows on the Northwest slopes.</p>

<p><img src="/shoals/assets/img/2014-08-24_3.png" alt="image" /></p>

<p>The same view in the Mapbox Studio “Satellite Afternoon” template — the solar azimuth is almost exactly the opposite of the underlying imagery.</p>

<p>It’s a quick enough fix to reverse the terrain shadows . . .</p>

<p><img src="/shoals/assets/img/2014-08-24_4.png" alt="image" /></p>

<p>The Mapbox Studio “Satellite Afternoon” template with hillshade matching the solar azimuth of the underlying imagery . . . at this location</p>

<p>. . . and now the hillshade compliments the imagery underneath, instead of fighting with it. This even allows us to reduce the desaturated feel of the imagery in the template, and bring up what is essentially terrain-enhanced imagery:</p>

<p><img src="/shoals/assets/img/2014-08-24_5.png" alt="image" /></p>

<p>Mapbox Studio “Satellite Afternoon” template with unfiltered imagery and azimuth-aligned, composited hillshade</p>

<p>To go completely nuts, we can layer in light contours so the shadows aren’t information vacuums:</p>

<p><img src="/shoals/assets/img/2014-08-24_6.png" alt="image" /></p>

<p>And now we’ve basically reversed the conceit of the “Satellite Afternoon” template, going from the stylized terrain map created by Mapbox to more of a terrain-accented satellite basemap. This is more of an information-dense basemap, so it probably won’t serve the same purpose as the original template. <a href="https://gist.github.com/wboykinm/8bd89a8b4ef0d489a4ba"><em>(Here’s the revised CartoCSS)</em></a></p>

<h3 id="back-to-the-quibble">Back to the quibble.</h3>

<p>It’s solved, right? Alas, if we travel to New Hampshire and the slopes of Mt. Washington, we find that hillshade and satellite shadows are again mismatched:</p>

<p><img src="/shoals/assets/img/2014-08-24_7.png" alt="image" /></p>

<p>Restyled “Satellite Afternoon”; arrow indicates the azimuth angle of the sun, about 90° misaligned with the overlain hillshade</p>

<p>In fact, despite <a href="https://www.mapbox.com/blog/processing-raw-naip-into-seamless-imagery/">the awesome work the Mapbox Satellite team has done standardizing colors and resolutions</a> in a globe of mismatched satellite imagery, it is essentially impossible to standardize solar angle. You can simulate shaded relief for any one image/location/date/time, but it cannot be made globally applicable.</p>

<p>When using ESRI’s satellite/terrain combo basemap years ago, I ultimately decided the best solution was to simply stop trying, and to go with either a shaded relief or a satellite surface. But in the intervening time my relationship with mapping problem solving has changed — helped by the open-source community and by Mapbox in particular — from “The platform can’t do it” to “How can we make the platform do it?” And their team has already <a href="https://www.mapbox.com/blog/dynamic-hill-shading/">had a few thoughts on the matter</a>:</p>

<p><img src="/shoals/assets/img/2014-08-24_8.jpeg" alt="image" /></p>

<p>Dynamic Hillshade demo built by Vladimir Agafonkin for Mapbox</p>

<p>If combining hillshade with satellite imagery is a cartographic problem that enough people want solved, I suspect it will get solved. In the meantime I’m going to continue working with Mapbox Studio and having a blast.</p>

<p><em>(Cover image of the Himalayas</em> <a href="http://eol.jsc.nasa.gov/scripts/sseop/photo.pl?mission=ISS008&amp;roll=E&amp;frame=13304"><em>taken from on board the ISS</em></a><em>, provided by NASA)</em></p>

      </article>

      

      

      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/shoals/2014/06/02/constellations-of-potential.html" data-toggle="tooltip" data-placement="top" title="Constellations of Potential">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/shoals/2014/11/14/palm-board-and-parchment.html" data-toggle="tooltip" data-placement="top" title="Palm board and parchment">Next Post &rarr;</a>
        </li>
        
      </ul>
      

    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"></ul>

      
      <p class="copyright text-muted">
      
      2023

      

      

      

      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/shoals/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>

<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Separation of Concerns | Shoals</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Separation of Concerns" />
<meta name="author" content="Bill Morris" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An occasional blog on geography, history, culture, and code." />
<meta property="og:description" content="An occasional blog on geography, history, culture, and code." />
<link rel="canonical" href="/shoals/2014/08/24/separation-of-concerns.html" />
<meta property="og:url" content="/shoals/2014/08/24/separation-of-concerns.html" />
<meta property="og:site_name" content="Shoals" />
<meta property="og:image" content="/shoals/shoals/assets/img/2014-08-24_1.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-24T14:08:18-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/shoals/shoals/assets/img/2014-08-24_1.png" />
<meta property="twitter:title" content="Separation of Concerns" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Bill Morris"},"dateModified":"2014-08-24T14:08:18-04:00","datePublished":"2014-08-24T14:08:18-04:00","description":"An occasional blog on geography, history, culture, and code.","headline":"Separation of Concerns","image":"/shoals/shoals/assets/img/2014-08-24_1.png","mainEntityOfPage":{"@type":"WebPage","@id":"/shoals/2014/08/24/separation-of-concerns.html"},"url":"/shoals/2014/08/24/separation-of-concerns.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/shoals/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/shoals/feed.xml" title="Shoals" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/shoals/">Shoals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Separation of Concerns</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-08-24T14:08:18-04:00" itemprop="datePublished">Aug 24, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Bill Morris</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <blockquote>
  <p>Working with shaded relief and satellite imagery in Mapbox Studio</p>
</blockquote>

<h3 id="i-have-a-minor-quibble">I have a minor quibble.</h3>

<p>Amid the wonders that the Mapbox team has been producing of late, they’ve rebranded the groundbreaking Tilemill as <a href="https://www.mapbox.com/mapbox-studio/#darwin">Mapbox Studio</a>, given it a souped-up engine powered by OpenStreetmap-based vector tiles, and turned it loose on the beta crowd to a reception somewhere between “rapturous” and “bieberesque”. It makes web mapping both better-supported and more flexible, and at <a href="http://faraday.io/">Faraday</a> we quickly used it to build <a href="https://api.tiles.mapbox.com/v4/faraday2.74974c94/page.html?access_token=pk.eyJ1IjoiZmFyYWRheTIiLCJhIjoiTUVHbDl5OCJ9.buFaqIdaIM3iXr1BOYKpsQ#14/42.3591/-71.0639">our basemap</a>.</p>

<p>Mapbox Studio comes with four starter templates . . .</p>

<p><img src="/shoals/assets/img/2014-08-24_1.png" alt="image" /></p>

<p>. . . and my quibble is with the <a href="https://github.com/mapbox/satellite-afternoon.tm2">“Satellite Afternoon” template</a>. I played with it for awhile before I noticed I was unhappy with it in a familiar way. Back in my desktop GIS days I had frequently used an ESRI-provided basemap that tried to do the same thing: Overlay shaded relief on satellite imagery. At the time I couldn’t quite place what I found wrong with this kind of basemap, but it’s now clear looking at the Mapbox version:</p>

<h3 id="the-shadows-arent-lining-up">The shadows aren’t lining up.</h3>

<p>Shaded relief maps present a stylized view of sunlight smacking terrain. Satellite imagery — unless acquired at nadir angle — shows actual sunlight on terrain. It’s very unlikely that the two will have exactly the same zenith and azimuth angles by chance:</p>

<p><img src="/shoals/assets/img/2014-08-24_2.png" alt="image" /></p>

<p>Mapbox Satellite view of the peaks near Eldorado Canyon in Colorado. Note the sun azimuth angle from the Southeast, casting shadows on the Northwest slopes.</p>

<p><img src="/shoals/assets/img/2014-08-24_3.png" alt="image" /></p>

<p>The same view in the Mapbox Studio “Satellite Afternoon” template — the solar azimuth is almost exactly the opposite of the underlying imagery.</p>

<p>It’s a quick enough fix to reverse the terrain shadows . . .</p>

<p><img src="/shoals/assets/img/2014-08-24_4.png" alt="image" /></p>

<p>The Mapbox Studio “Satellite Afternoon” template with hillshade matching the solar azimuth of the underlying imagery . . . at this location</p>

<p>. . . and now the hillshade compliments the imagery underneath, instead of fighting with it. This even allows us to reduce the desaturated feel of the imagery in the template, and bring up what is essentially terrain-enhanced imagery:</p>

<p><img src="/shoals/assets/img/2014-08-24_5.png" alt="image" /></p>

<p>Mapbox Studio “Satellite Afternoon” template with unfiltered imagery and azimuth-aligned, composited hillshade</p>

<p>To go completely nuts, we can layer in light contours so the shadows aren’t information vacuums:</p>

<p><img src="/shoals/assets/img/2014-08-24_6.png" alt="image" /></p>

<p>And now we’ve basically reversed the conceit of the “Satellite Afternoon” template, going from the stylized terrain map created by Mapbox to more of a terrain-accented satellite basemap. This is more of an information-dense basemap, so it probably won’t serve the same purpose as the original template. <a href="https://gist.github.com/wboykinm/8bd89a8b4ef0d489a4ba"><em>(Here’s the revised CartoCSS)</em></a></p>

<h3 id="back-to-the-quibble">Back to the quibble.</h3>

<p>It’s solved, right? Alas, if we travel to New Hampshire and the slopes of Mt. Washington, we find that hillshade and satellite shadows are again mismatched:</p>

<p><img src="/shoals/assets/img/2014-08-24_7.png" alt="image" /></p>

<p>Restyled “Satellite Afternoon”; arrow indicates the azimuth angle of the sun, about 90° misaligned with the overlain hillshade</p>

<p>In fact, despite <a href="https://www.mapbox.com/blog/processing-raw-naip-into-seamless-imagery/">the awesome work the Mapbox Satellite team has done standardizing colors and resolutions</a> in a globe of mismatched satellite imagery, it is essentially impossible to standardize solar angle. You can simulate shaded relief for any one image/location/date/time, but it cannot be made globally applicable.</p>

<p>When using ESRI’s satellite/terrain combo basemap years ago, I ultimately decided the best solution was to simply stop trying, and to go with either a shaded relief or a satellite surface. But in the intervening time my relationship with mapping problem solving has changed — helped by the open-source community and by Mapbox in particular — from “The platform can’t do it” to “How can we make the platform do it?” And their team has already <a href="https://www.mapbox.com/blog/dynamic-hill-shading/">had a few thoughts on the matter</a>:</p>

<p><img src="/shoals/assets/img/2014-08-24_8.jpeg" alt="image" /></p>

<p>Dynamic Hillshade demo built by Vladimir Agafonkin for Mapbox</p>

<p>If combining hillshade with satellite imagery is a cartographic problem that enough people want solved, I suspect it will get solved. In the meantime I’m going to continue working with Mapbox Studio and having a blast.</p>

<p><em>(Cover image of the Himalayas</em> <a href="http://eol.jsc.nasa.gov/scripts/sseop/photo.pl?mission=ISS008&amp;roll=E&amp;frame=13304"><em>taken from on board the ISS</em></a><em>, provided by NASA)</em></p>

  </div><a class="u-url" href="/shoals/2014/08/24/separation-of-concerns.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/shoals/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Shoals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Shoals</li><li><a class="u-email" href="mailto:bill@billmorris.io">bill@billmorris.io</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wboykinm"><svg class="svg-icon"><use xlink:href="/shoals/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wboykinm</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>An occasional blog on geography, history, culture, and code.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Compton :: Shoals</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Recreating a Superbowl halftime show basemap" />
<meta name="keywords" content="compton, superbowl, postgis, football, cartography, mapping, hiphop" />
<meta name="robots" content="noodp" />

<link rel="canonical" href="/shoals/posts/2022-02-14_compton/" />






  
  
  
  
  
  <link rel="stylesheet" href="/shoals/styles.css">







  <link rel="shortcut icon" href="/shoals/img/theme-colors/blue.png">
  <link rel="apple-touch-icon" href="/shoals/img/theme-colors/blue.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Compton">
<meta property="og:description" content="Recreating a Superbowl halftime show basemap" />
<meta property="og:url" content="/shoals/posts/2022-02-14_compton/" />
<meta property="og:site_name" content="Shoals" />

  
  
    
  
  <meta property="og:image" content="/shoals/posts/2022-02-14_compton/images/1.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-02-14 11:30:19 -0400 -0400" />












</head>
<body class="blue">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/shoals/">
  <div class="logo">
    Shoals - a blog by Bill Morris
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/shoals/posts/2022-02-14_compton/">Compton</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2022-02-14 ::
        
      </time>
    
    
      <span class="post-author">Bill Morris</span>
    
    
  </div>

  
  
  <img src="/shoals/posts/2022-02-14_compton/images/1.png"
    class="post-cover"
    alt="Compton"
    title="Cover Image" />


  

  <div class="post-content"><div>
        <h1 id="compton-streetlights">Compton streetlights<a href="#compton-streetlights" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Generating points with PostGIS . . . to approximate streetlight locations in Compton, Los Angeles.</p>
<p>Loose homage to <a href="https://youtu.be/Z-48u_uWMHY?t=275">Kendrick Lamar</a>, strong shouts to Snoop, Dre, Mary J., and <a href="https://youtu.be/gdsUKphmB3Y?t=34">the map underneath the 2022 Superbowl Halftime Show</a>, and big respect to <a href="https://pw.lacounty.gov/tnl/streetlights/docs/guidelines.pdf">the L.A. county streetlight spacing guidelines</a>.</p>
<p><img src="images/3.jpeg" alt="3">
<em>Photo by David Crane, <a href="https://www.dailynews.com/2022/02/13/fans-loved-the-super-bowl-halftime-show-celebrating-la-especially-compton/">Los Angeles Daily News/SCNG</a></em></p>
<h2 id="get-streets-data">Get streets data<a href="#get-streets-data" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Openstreetmap, as always, is the perfect starting point for data. From <a href="https://overpass-turbo.eu/s/1g6d">overpass turbo</a>, pull the local street grid as GeoJSON.</p>
<pre tabindex="0"><code>/*
This has been generated by the overpass-turbo wizard.
The original search was:
“highway=* and type:way”
*/
[out:json][timeout:25];
// gather results
(
  // query part for: “highway=*”
  way[&#34;highway&#34;]({{bbox}});
);
// print results
out body;
&gt;;
out skel qt;
</code></pre><p>Download as <code>compton_highway.geojson</code>.</p>
<h2 id="add-to-postgis">Add to PostGIS<a href="#add-to-postgis" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Create a working DB and import the data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>DBURL<span style="color:#f92672">=</span>compton
</span></span><span style="display:flex;"><span>dropdb $DBURL --if-exists
</span></span><span style="display:flex;"><span>createdb $DBURL
</span></span><span style="display:flex;"><span>psql $DBURL -c <span style="color:#e6db74">&#34;CREATE EXTENSION postgis;&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ogr2ogr <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -f <span style="color:#e6db74">&#34;PostgreSQL&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  PG:<span style="color:#e6db74">&#34;host=localhost dbname=</span>$DBURL<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  compton_highway.geojson <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -t_srs <span style="color:#e6db74">&#34;EPSG:3857&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -nln still_got_love_for_these_streets <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -lco GEOMETRY_NAME<span style="color:#f92672">=</span>the_geom <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -nlt PROMOTE_TO_MULTI <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -progress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -overwrite
</span></span></code></pre></div><h2 id="generate-streetlight-points">Generate streetlight points<a href="#generate-streetlight-points" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>. . . using the magic of PostGIS</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>psql $DBURL -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  DROP TABLE IF EXISTS kendrick_lights;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  CREATE TABLE kendrick_lights AS (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    WITH streets AS (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      SELECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        -- Set linear light spacing based on CA guidelines
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        (CASE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          WHEN highway LIKE &#39;%motorway%&#39; THEN 200
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ELSE 50
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        END) AS spacing,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        -- Pull linestrings from multilinestrings
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        (ST_Dump(the_geom)).geom AS the_geom
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FROM still_got_love_for_these_streets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      -- Ignore the polygons from the overpass export
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WHERE ST_geometrytype(the_geom) = &#39;ST_MultiLineString&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    lolos AS (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      SELECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        -- Generative point function
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ST_LineInterpolatePoints(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          -- Use the outer boundary of a 10m buffer around all streets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ST_ExteriorRing(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ST_Buffer(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              the_geom,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          -- Only use one point if the street segment is shorter than the class spacing
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          (CASE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            WHEN spacing &gt;= ST_Length(the_geom) THEN 0.5::float
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ELSE spacing/(ST_Length(the_geom))::float
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          END),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ) AS the_geom
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FROM streets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    SELECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      (ST_Dump(the_geom)).geom AS the_geom
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    FROM lolos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h2 id="export-to-geojson">Export to GeoJSON<a href="#export-to-geojson" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ogr2ogr <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -f <span style="color:#e6db74">&#34;GeoJSON&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -t_srs <span style="color:#e6db74">&#34;EPSG:4326&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  streetlights.geojson <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  PG:<span style="color:#e6db74">&#34;host=localhost dbname=</span>$DBURL<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#34;kendrick_lights(the_geom)&#34;</span>
</span></span></code></pre></div><p>And ta-daaaaa:</p>
<p><img src="images/4.png" alt="4"></p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="/shoals/posts/2022-03-09_grad-school-hoard/">
                <span class="button__icon">←</span>
                <span class="button__text">The things he carried</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="/shoals/posts/2022-01-21_how-to-internet/">
                <span class="button__text">How to deploy a webpage in 2022</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2023 by <a href="https://billmorris.io">Bill Morris</a>, powered by <a href="http://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/shoals/bundle.min.js"></script>





  
</div>

</body>
</html>

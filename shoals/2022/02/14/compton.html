<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 6.0.1 | Copyright Dean Attali 2023 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Compton</title>

  

  <meta name="description" content="Compton streetlights Generating points with PostGIS . . . to approximate streetlight locations in Compton, Los Angeles. Loose homage to Kendrick Lamar, strong shouts to Snoop, Dre, Mary J., and the map underneath the 2022 Superbowl Halftime Show, and big respect to the L.A. county streetlight spacing guidelines. Photo by...">

  

  

  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/shoals/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/shoals/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Shoals">
  <meta property="og:title" content="Compton">
  <meta property="og:description" content="Compton streetlights Generating points with PostGIS . . . to approximate streetlight locations in Compton, Los Angeles. Loose homage to Kendrick Lamar, strong shouts to Snoop, Dre, Mary J., and the map underneath the 2022 Superbowl Halftime Show, and big respect to the L.A. county streetlight spacing guidelines. Photo by...">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="">
  <meta property="og:article:published_time" content="2022-02-14T10:30:19-05:00">
  <meta property="og:url" content="/shoals/2022/02/14/compton.html">
  <link rel="canonical" href="/shoals/2022/02/14/compton.html">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="Compton">
  <meta property="twitter:description" content="Compton streetlights Generating points with PostGIS . . . to approximate streetlight locations in Compton, Los Angeles. Loose homage to Kendrick Lamar, strong shouts to Snoop, Dre, Mary J., and the map underneath the 2022 Superbowl Halftime Show, and big respect to the L.A. county streetlight spacing guidelines. Photo by...">

  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="/shoals">Shoals</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto"></ul>
  </div>

  

  

</nav>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Compton</h1>
          

          
            <span class="post-meta">Posted on February 14, 2022</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <p><img src="/shoals/assets/img/2022-02-14_1.png" alt="1" /></p>

<h1 id="compton-streetlights">Compton streetlights</h1>
<p>Generating points with PostGIS . . . to approximate streetlight locations in Compton, Los Angeles.</p>

<p>Loose homage to <a href="https://youtu.be/Z-48u_uWMHY?t=275">Kendrick Lamar</a>, strong shouts to Snoop, Dre, Mary J., and <a href="https://youtu.be/gdsUKphmB3Y?t=34">the map underneath the 2022 Superbowl Halftime Show</a>, and big respect to <a href="https://pw.lacounty.gov/tnl/streetlights/docs/guidelines.pdf">the L.A. county streetlight spacing guidelines</a>.</p>

<p><img src="/shoals/assets/img/2022-02-14_3.jpeg" alt="3" />
<em>Photo by David Crane, <a href="https://www.dailynews.com/2022/02/13/fans-loved-the-super-bowl-halftime-show-celebrating-la-especially-compton/">Los Angeles Daily News/SCNG</a></em></p>

<h2 id="get-streets-data">Get streets data</h2>
<p>Openstreetmap, as always, is the perfect starting point for data. From <a href="https://overpass-turbo.eu/s/1g6d">overpass turbo</a>, pull the local street grid as GeoJSON.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*
This has been generated by the overpass-turbo wizard.
The original search was:
“highway=* and type:way”
*/
[out:json][timeout:25];
// gather results
(
  // query part for: “highway=*”
  way["highway"]();
);
// print results
out body;
&gt;;
out skel qt;
</code></pre></div></div>

<p>Download as <code class="language-plaintext highlighter-rouge">compton_highway.geojson</code>.</p>

<h2 id="add-to-postgis">Add to PostGIS</h2>
<p>Create a working DB and import the data:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">DBURL</span><span class="o">=</span>compton
dropdb <span class="nv">$DBURL</span> <span class="nt">--if-exists</span>
createdb <span class="nv">$DBURL</span>
psql <span class="nv">$DBURL</span> <span class="nt">-c</span> <span class="s2">"CREATE EXTENSION postgis;"</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ogr2ogr <span class="se">\</span>
  <span class="nt">-f</span> <span class="s2">"PostgreSQL"</span> <span class="se">\</span>
  PG:<span class="s2">"host=localhost dbname=</span><span class="nv">$DBURL</span><span class="s2">"</span> <span class="se">\</span>
  compton_highway.geojson <span class="se">\</span>
  <span class="nt">-t_srs</span> <span class="s2">"EPSG:3857"</span> <span class="se">\</span>
  <span class="nt">-nln</span> still_got_love_for_these_streets <span class="se">\</span>
  <span class="nt">-lco</span> <span class="nv">GEOMETRY_NAME</span><span class="o">=</span>the_geom <span class="se">\</span>
  <span class="nt">-nlt</span> PROMOTE_TO_MULTI <span class="se">\</span>
  <span class="nt">-progress</span> <span class="se">\</span>
  <span class="nt">-overwrite</span>
</code></pre></div></div>

<h2 id="generate-streetlight-points">Generate streetlight points</h2>
<p>. . . using the magic of PostGIS</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nv">$DBURL</span> <span class="nt">-c</span> <span class="s2">"
  DROP TABLE IF EXISTS kendrick_lights;
  CREATE TABLE kendrick_lights AS (
    WITH streets AS (
      SELECT
        -- Set linear light spacing based on CA guidelines
        (CASE
          WHEN highway LIKE '%motorway%' THEN 200
          ELSE 50
        END) AS spacing,
        -- Pull linestrings from multilinestrings
        (ST_Dump(the_geom)).geom AS the_geom
      FROM still_got_love_for_these_streets
      -- Ignore the polygons from the overpass export
      WHERE ST_geometrytype(the_geom) = 'ST_MultiLineString'
    ),
    lolos AS (
      SELECT
        -- Generative point function
        ST_LineInterpolatePoints(
          -- Use the outer boundary of a 10m buffer around all streets
          ST_ExteriorRing(
            ST_Buffer(
              the_geom,
              10
            )
          ),
          -- Only use one point if the street segment is shorter than the class spacing
          (CASE
            WHEN spacing &gt;= ST_Length(the_geom) THEN 0.5::float
            ELSE spacing/(ST_Length(the_geom))::float
          END),
          true
        ) AS the_geom
      FROM streets
    )
    SELECT
      (ST_Dump(the_geom)).geom AS the_geom
    FROM lolos
  )
"</span>
</code></pre></div></div>

<h2 id="export-to-geojson">Export to GeoJSON</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ogr2ogr <span class="se">\</span>
  <span class="nt">-f</span> <span class="s2">"GeoJSON"</span> <span class="se">\</span>
  <span class="nt">-t_srs</span> <span class="s2">"EPSG:4326"</span> <span class="se">\</span>
  streetlights.geojson <span class="se">\</span>
  PG:<span class="s2">"host=localhost dbname=</span><span class="nv">$DBURL</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"kendrick_lights(the_geom)"</span>
</code></pre></div></div>

<p>And ta-daaaaa:</p>

<p><img src="/shoals/assets/img/2022-02-14_4.png" alt="4" /></p>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/shoals/tags#compton">compton</a>
          
            <a href="/shoals/tags#superbowl">superbowl</a>
          
            <a href="/shoals/tags#postgis">postgis</a>
          
            <a href="/shoals/tags#football">football</a>
          
            <a href="/shoals/tags#cartography">cartography</a>
          
            <a href="/shoals/tags#mapping">mapping</a>
          
            <a href="/shoals/tags#hiphop">hiphop</a>
          
        </div>
      

      

      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/shoals/2022/01/21/how-to-internet.html" data-toggle="tooltip" data-placement="top" title="How to deploy a webpage in 2022">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/shoals/2022/03/09/grad-school-hoard.html" data-toggle="tooltip" data-placement="top" title="The things he carried">Next Post &rarr;</a>
        </li>
        
      </ul>
      

    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"></ul>

      
      <p class="copyright text-muted">
      
      2023

      

      

      

      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/shoals/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
